# 모바일 여백 및 Splash 수정 계획

## 📋 작업 일자
- **날짜**: 2025-12-21
- **작업자**: Claude Code

---

## 🎯 문제 1: 모바일 앱 상단 여백 부족

### 현상
- 모바일 앱에서 헤더(검색 아이콘, 메뉴)와 상단 보라색 배너 사이 여백 없음
- PC에서는 정상적으로 여백 있음
- 모바일 웹에서는 정상, **앱에서만 문제**

### 원인
- 앱 전용 여백 설정이 없음
- `#hd` (헤더)와 `#container` (컨텐츠) 사이 margin 없음

---

## 💡 해결 방법 (3가지 중 선택)

### **방법 1: CSS에 앱 전용 여백 추가** ✅ 가장 간단

#### 수정 파일
`theme/rb.basic/css/mobile.css`

#### 수정 위치
파일 하단 (약 150라인 이후)

#### 추가 코드
```css
/* ============================================ */
/* ✅ 앱 전용 여백 추가 (2025-12-21) */
/* ============================================ */
/* 앱에서만 헤더 하단 여백 추가 */
body[data-app="true"] #hd {
    margin-bottom: 15px;
}

/* 또는 컨텐츠 상단 여백 추가 */
body[data-app="true"] #container {
    padding-top: 15px !important;
}
/* ============================================ */
```

#### head.sub.php 수정 필요
`theme/rb.basic/head.sub.php` 파일에서 `<body>` 태그 수정

**수정 전:**
```php
<body<?php if ($is_admin) echo ' class="admin"'; ?>>
```

**수정 후:**
```php
<body<?php if ($is_admin) echo ' class="admin"'; ?><?php
// 앱 감지
$is_app_view = false;
if (isset($_GET['app']) && $_GET['app'] == '1') {
    $is_app_view = true;
} else if (strpos($_SERVER['HTTP_USER_AGENT'], 'AppName') !== false) {
    $is_app_view = true;
}
if ($is_app_view) echo ' data-app="true"';
?>>
```

---

### **방법 2: JavaScript로 동적 여백 추가**

#### 수정 파일
`theme/rb.basic/mobile/head.php`

#### 수정 위치
`</header>` 태그 직후 (라인 184 이후)

#### 추가 코드
```html
</header>

<!-- ============================================ -->
<!-- ✅ 앱 전용 여백 추가 스크립트 -->
<!-- ============================================ -->
<script>
$(document).ready(function() {
    // URL 파라미터 또는 User-Agent로 앱 감지
    var isApp = false;
    var urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('app') === '1') {
        isApp = true;
    } else if (navigator.userAgent.indexOf('AppName') > -1) {
        isApp = true;
    }

    // 앱이면 여백 추가
    if (isApp) {
        $('#hd').css('margin-bottom', '15px');
        // 또는
        // $('#container').css('padding-top', '15px');
    }
});
</script>
<!-- ============================================ -->

<div id="wrapper">
```

---

### **방법 3: 모바일 전용 인라인 스타일**

#### 수정 파일
`theme/rb.basic/mobile/head.php`

#### 수정 위치
`<header id="hd">` 태그 수정

**수정 전:**
```php
<header id="hd">
```

**수정 후:**
```php
<?php
// 앱 감지
$is_app_header = false;
if (isset($_GET['app']) && $_GET['app'] == '1') {
    $is_app_header = true;
} else if (strpos($_SERVER['HTTP_USER_AGENT'], 'AppName') !== false) {
    $is_app_header = true;
}
?>
<header id="hd"<?php if ($is_app_header) echo ' style="margin-bottom:15px;"'; ?>>
```

---

## 🎯 문제 2: Splash 1회만 표시

### 현상
- 메인 페이지 방문 시마다 splash 표시됨
- 앱에서 뒤로가기 시 splash 재진입

### 원인
- 메인 페이지에서 splash 호출 로직 없음
- 쿠키/세션 체크 없이 매번 표시

---

## 💡 해결 방법: 쿠키 플래그 방식

### **수정 1: index.php에 splash 호출 로직 추가**

#### 수정 파일
`www/index.php` 또는 `theme/rb.basic/index.php`

#### 수정 위치
파일 최상단 `include_once('./_common.php');` 직후

#### 추가 코드
```php
<?php
include_once('./_common.php');

// ============================================
// ✅ Splash 1회만 표시 (쿠키 방식)
// ============================================
// 앱 감지
$is_app_splash = false;
if (isset($_GET['app']) && $_GET['app'] == '1') {
    $is_app_splash = true;
} else if (strpos($_SERVER['HTTP_USER_AGENT'], 'AppName') !== false) {
    $is_app_splash = true;
}

// 앱에서 첫 방문 시에만 splash 표시
if ($is_app_splash && !isset($_COOKIE['hairwang_splash_shown'])) {
    // splash를 본 적이 없으면 쿠키 설정 후 splash.php로 리다이렉트
    setcookie('hairwang_splash_shown', '1', time() + (365 * 24 * 60 * 60), '/'); // 1년 유지

    // 현재 URL을 다음 페이지로 설정
    $next_url = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? "https" : "http") . "://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";

    // splash.php로 리다이렉트
    header("Location: /rb/splash.php?app=1&url=" . urlencode($next_url));
    exit;
}
// ============================================

if($member['mb_id'] == 'developer'){
    //goto_url('test10.php');
    //exit;
}

define('_INDEX_', true);
// 이하 기존 코드...
```

---

### **수정 2: splash.php 수정 (선택사항)**

#### 수정 파일
`rb/splash.php`

#### 수정 내용
기존 세션 체크 코드는 유지하고, 추가 방어만 추가

```php
// 기존 코드
if ($is_app && isset($_SESSION['app_splash_shown'])) {
    goto_url(G5_URL);
    exit;
}
if ($is_app) {
    $_SESSION['app_splash_shown'] = true;
}

// ✅ 추가: 쿠키로도 체크 (이중 방어)
if ($is_app && isset($_COOKIE['hairwang_splash_shown'])) {
    goto_url(G5_URL);
    exit;
}
```

---

## 📊 동작 흐름

### ✅ 수정 후 동작

```
앱 최초 실행
    ↓
https://hairwang.com/?app=1 접속
    ↓
index.php: 쿠키 체크
    → 쿠키 없음 → setcookie() → splash.php로 리다이렉트
    ↓
splash.php 표시 (3초)
    ↓
메인으로 이동 (쿠키 저장됨)
    ↓
이후 방문
    ↓
index.php: 쿠키 체크
    → 쿠키 있음 → splash 건너뛰고 바로 메인 표시 ✅
```

---

## 🧪 테스트 방법

### 1. 모바일 여백 테스트
1. 앱에서 `https://hairwang.com/?app=1` 접속
2. 헤더와 상단 배너 사이 여백 확인
3. PC에서 접속하여 기존 레이아웃 변경 없는지 확인

### 2. Splash 1회 표시 테스트
1. 앱 재시작 (또는 쿠키 삭제)
2. `https://hairwang.com/?app=1` 접속
3. Splash 화면 표시 확인
4. 메인 페이지 진입 확인
5. 앱 재시작 후 다시 접속
6. Splash 건너뛰고 바로 메인 표시 확인 ✅

### 3. 쿠키 초기화 방법
브라우저 개발자 도구 → Application → Cookies → `hairwang_splash_shown` 삭제

---

## 📌 주의사항

### 쿠키 vs 세션
| 비교 | 쿠키 | 세션 |
|------|------|------|
| 저장 위치 | 클라이언트 (앱) | 서버 |
| 유지 기간 | 1년 (설정 가능) | 앱 종료 시 삭제 |
| 앱 재시작 | ✅ 유지됨 | ❌ 초기화됨 |
| 추천 | ✅ Splash 1회 표시에 적합 | ❌ 앱 재시작마다 표시됨 |

### 쿠키 유지 기간 설정
```php
// 1일
time() + (1 * 24 * 60 * 60)

// 1주일
time() + (7 * 24 * 60 * 60)

// 1개월
time() + (30 * 24 * 60 * 60)

// 1년 (권장)
time() + (365 * 24 * 60 * 60)

// 영구 (10년)
time() + (10 * 365 * 24 * 60 * 60)
```

---

## ✅ 권장 조합

### 최종 권장 방법

1. **모바일 여백**: 방법 1 (CSS + body 속성)
   - 가장 깔끔하고 유지보수 쉬움
   - CSS만 수정하면 되므로 간단

2. **Splash 1회 표시**: 쿠키 방식
   - 앱 재시작해도 유지됨
   - 세션보다 안정적

---

## 📝 체크리스트

- [ ] mobile.css에 앱 전용 여백 추가
- [ ] head.sub.php에 body 속성 추가
- [ ] index.php에 splash 호출 로직 추가
- [ ] 앱에서 여백 확인 테스트
- [ ] PC에서 기존 레이아웃 유지 확인
- [ ] Splash 1회 표시 테스트
- [ ] 앱 재시작 후 Splash 안 나오는지 확인

---

## 🔧 롤백 방법

### 문제 발생 시 원복

#### 1. mobile.css 원복
추가한 코드 삭제:
```css
/* 이 부분 전체 삭제 */
body[data-app="true"] #hd {
    margin-bottom: 15px;
}
```

#### 2. head.sub.php 원복
`<body>` 태그를 원래대로:
```php
<body<?php if ($is_admin) echo ' class="admin"'; ?>>
```

#### 3. index.php 원복
추가한 splash 호출 로직 전체 삭제

---

## 📞 디버깅

### 여백이 안 보이는 경우
1. 브라우저 개발자 도구에서 `body` 태그 확인
2. `data-app="true"` 속성 있는지 확인
3. CSS가 적용되었는지 확인

### Splash가 계속 나오는 경우
1. 쿠키가 설정되었는지 확인
   - 개발자 도구 → Application → Cookies
2. `hairwang_splash_shown` 쿠키 존재하는지 확인
3. 쿠키 경로가 `/`로 설정되었는지 확인
