<?php
/**
 * ========================================
 * í‘¸ì‹œ ì•Œë¦¼ ëŒ€ì‹œë³´ë“œ - ë©”ì¸ í˜ì´ì§€
 * ========================================
 *
 * ê°œë³„ í‘¸ì‹œ ë° ì „ì²´ í‘¸ì‹œ ì•Œë¦¼ì„ ì „ì†¡í•  ìˆ˜ ìˆëŠ” ì›¹ UIë¥¼ ì œê³µí•©ë‹ˆë‹¤.
 *
 * @file    index.php
 * @updated 2025-12-17
 * @version 2.2.0
 * @changes
 *   - ì—ëŸ¬ í•¸ë“¤ë§ ë° ë””ë²„ê¹… ì½”ë“œ ì¶”ê°€
 *   - Try-catch êµ¬ë¬¸ìœ¼ë¡œ ì—ëŸ¬ ìº¡ì²˜
 *   - ì½˜ì†” ë¡œê·¸ ì¶œë ¥ ì¶”ê°€
 */

// ============================================
// ì—ëŸ¬ ë¦¬í¬íŒ… ì„¤ì • (ë””ë²„ê¹…ìš©)
// ============================================
error_reporting(E_ALL);
ini_set('display_errors', 1);
ini_set('log_errors', 1);
ini_set('error_log', __DIR__ . '/logs/php_errors.log');

// ============================================
// ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡
// ============================================
set_error_handler(function($errno, $errstr, $errfile, $errline) {
    $error_msg = "[$errno] $errstr in $errfile on line $errline";
    error_log($error_msg);
    echo "<script>console.error('PHP Error: " . addslashes($error_msg) . "');</script>";
    return false;
});

// ============================================
// ì˜ˆì™¸ í•¸ë“¤ëŸ¬ ë“±ë¡
// ============================================
set_exception_handler(function($exception) {
    $error_msg = "Uncaught Exception: " . $exception->getMessage() . " in " . $exception->getFile() . " on line " . $exception->getLine();
    error_log($error_msg);
    echo "<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Error</title></head><body>";
    echo "<h1>500 Internal Server Error</h1>";
    echo "<pre>" . htmlspecialchars($error_msg) . "</pre>";
    echo "<script>console.error('Exception: " . addslashes($error_msg) . "');</script>";
    echo "</body></html>";
    exit;
});

// ============================================
// Try-Catchë¡œ ì „ì²´ ì½”ë“œ ê°ì‹¸ê¸°
// ============================================
try {
    // ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±
    $log_dir = __DIR__ . '/logs';
    if (!is_dir($log_dir)) {
        mkdir($log_dir, 0755, true);
    }

    echo "<script>console.log('Step 1: Starting index.php');</script>";

    // ì¸ì¦ ì‹œìŠ¤í…œ ë¡œë“œ ë° ë¡œê·¸ì¸ ì²´í¬
    if (!file_exists(__DIR__ . '/auth.php')) {
        throw new Exception('auth.php file not found');
    }

    echo "<script>console.log('Step 2: Loading auth.php');</script>";
    require_once __DIR__ . '/auth.php';

    echo "<script>console.log('Step 3: Checking login status');</script>";
    require_login();  // ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìëŠ” login.phpë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸

    echo "<script>console.log('Step 4: Getting current user');</script>";
    // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    $current_user = get_auth_user();

    if (!$current_user) {
        throw new Exception('Failed to get current user info');
    }

    echo "<script>console.log('Step 5: User logged in - " . addslashes($current_user['username']) . "');</script>";

    // config.php ë¡œë“œ (í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì„¤ì • ì‚¬ìš©)
    echo "<script>console.log('Step 6: Loading config.php');</script>";
    require_once __DIR__ . '/config.php';

    // í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì„¤ì • ë¡œë“œ
    echo "<script>console.log('Step 7: Loading test notification config');</script>";
    $test_notification_config = get_test_notification_config();

    echo "<script>console.log('Step 8: All initialization complete');</script>";

} catch (Exception $e) {
    // ì—ëŸ¬ ë°œìƒ ì‹œ ìì„¸í•œ ì •ë³´ ì¶œë ¥
    $error_details = [
        'message' => $e->getMessage(),
        'file' => $e->getFile(),
        'line' => $e->getLine(),
        'trace' => $e->getTraceAsString()
    ];

    error_log("Fatal Error in index.php: " . print_r($error_details, true));

    echo "<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Error</title>";
    echo "<style>body{font-family:Arial;padding:20px;}pre{background:#f4f4f4;padding:15px;border-radius:5px;overflow:auto;}</style>";
    echo "</head><body>";
    echo "<h1>ğŸš¨ 500 Internal Server Error</h1>";
    echo "<h2>Error Details:</h2>";
    echo "<pre>" . htmlspecialchars(print_r($error_details, true)) . "</pre>";
    echo "<h3>Debug Information:</h3>";
    echo "<ul>";
    echo "<li>PHP Version: " . PHP_VERSION . "</li>";
    echo "<li>Current Directory: " . __DIR__ . "</li>";
    echo "<li>auth.php exists: " . (file_exists(__DIR__ . '/auth.php') ? 'YES' : 'NO') . "</li>";
    echo "<li>Session status: " . session_status() . "</li>";
    echo "</ul>";
    echo "<script>console.error('Fatal Error:', " . json_encode($error_details) . ");</script>";
    echo "</body></html>";
    exit;
}
?>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 30px auto;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: none;
            overflow: hidden;
        }
        .card-header {
            background-color: #4e73df;
            color: white;
            font-weight: bold;
            padding: 15px 20px;
            border-bottom: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .test-settings-checkbox {
            margin-left: 25px;
            display: flex !important;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 8px;
        }
        .test-settings-checkbox .form-check-input {
            width: 22px;
            height: 22px;
            margin-right: 10px;
            cursor: pointer;
            border: 2px solid white !important;
            background-color: transparent;
            position: relative;
            flex-shrink: 0;
        }
        .test-settings-checkbox .form-check-input:checked {
            background-color: #1cc88a !important;
            border-color: #1cc88a !important;
        }
        .test-settings-checkbox label {
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 0 !important;
            white-space: nowrap;
            color: white !important;
        }
        .test-settings-checkbox label i {
            margin-right: 5px;
        }
        .card-body {
            padding: 30px;
        }
        .btn-primary {
            background-color: #4e73df;
            border-color: #4e73df;
            padding: 10px 20px;
            font-weight: 600;
            border-radius: 8px;
        }
        .btn-primary:hover {
            background-color: #2e59d9;
            border-color: #2e59d9;
        }
        .form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #d1d3e2;
        }
        .form-control:focus {
            border-color: #4e73df;
            box-shadow: 0 0 0 0.25rem rgba(78, 115, 223, 0.25);
        }
        .nav-tabs {
            border-bottom: none;
            margin-bottom: 20px;
        }
        .nav-tabs .nav-link {
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            margin-right: 10px;
            font-weight: 600;
            color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            background-color: #4e73df;
            color: white;
        }
        .tab-content {
            padding: 20px 0;
        }
        .alert {
            border-radius: 8px;
            padding: 15px 20px;
        }
        .device-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        .preview-box {
            border: 1px solid #d1d3e2;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            background-color: white;
        }
        .preview-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .preview-body {
            color: #6c757d;
        }
        .preview-device {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }
        .preview-device.android {
            background-color: #a4c639;
            color: white;
        }
        .preview-device.ios {
            background-color: #a2aaad;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <h3 class="m-0">í‘¸ì‹œ ì•Œë¦¼ ì‹œìŠ¤í…œ</h3>
                            <!-- í…ŒìŠ¤íŠ¸ ì„¤ì • ì‚¬ìš© ì²´í¬ë°•ìŠ¤ -->
                            <div class="form-check test-settings-checkbox">
                                <input class="form-check-input" type="checkbox" id="useTestSettings">
                                <label class="form-check-label text-white" for="useTestSettings">
                                    <i class="fas fa-flask"></i> í…ŒìŠ¤íŠ¸ ì„¤ì • ì‚¬ìš©
                                </label>
                            </div>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
                            <span class="text-white me-2">
                                <i class="fas fa-user-circle"></i>
                                <?php echo htmlspecialchars($current_user['username']); ?>
                            </span>
                            <!-- API í˜¸ì¶œë°©ë²• ë²„íŠ¼ -->
                            <a href="api_docs.php" target="_blank" class="btn btn-info btn-sm">
                                <i class="fas fa-book"></i> API í˜¸ì¶œë°©ë²•
                            </a>
                            <!-- ì•Œë¦¼ì„¤ì • ë²„íŠ¼ -->
                            <a href="settings.php" class="btn btn-light btn-sm">
                                <i class="fas fa-cog"></i> ì•Œë¦¼ì„¤ì •
                            </a>
                            <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
                            <a href="logout.php" class="btn btn-outline-light btn-sm">
                                <i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="pushTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="individual-tab" data-bs-toggle="tab" data-bs-target="#individual" type="button" role="tab" aria-controls="individual" aria-selected="true">
                                    <i class="fas fa-user"></i> ê°œë³„ í‘¸ì‹œ
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="group-tab" data-bs-toggle="tab" data-bs-target="#group" type="button" role="tab" aria-controls="group" aria-selected="false">
                                    <i class="fas fa-users"></i> ì „ì²´ í‘¸ì‹œ
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="pushTabsContent">
                            <!-- ê°œë³„ í‘¸ì‹œ íƒ­ -->
                            <div class="tab-pane fade show active" id="individual" role="tabpanel" aria-labelledby="individual-tab">
                                <form id="individualPushForm" action="push_api.php" method="post">
                                    <input type="hidden" name="push_type" value="individual">
                                    
                                    <div class="mb-3">
                                        <label for="device_type" class="form-label">ê¸°ê¸° ìœ í˜•</label>
                                        <div class="d-flex">
                                            <div class="form-check me-4">
                                                <input class="form-check-input" type="radio" name="app" id="android" value="android" checked>
                                                <label class="form-check-label" for="android">
                                                    <i class="fab fa-android device-icon text-success"></i>ì•ˆë“œë¡œì´ë“œ
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="app" id="ios" value="ios">
                                                <label class="form-check-label" for="ios">
                                                    <i class="fab fa-apple device-icon text-dark"></i>iOS
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="token" class="form-label">ì‚¬ìš©ì í† í°</label>
                                        <textarea class="form-control" id="token" name="user_token" rows="2" required placeholder="FCM í† í°ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="title" class="form-label">ì œëª©</label>
                                        <input type="text" class="form-control" id="title" name="title" required placeholder="ì•Œë¦¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="message" class="form-label">ë‚´ìš©</label>
                                        <textarea class="form-control" id="message" name="memo" rows="3" required placeholder="ì•Œë¦¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="url" class="form-label">URL (ì„ íƒì‚¬í•­)</label>
                                        <input type="url" class="form-control" id="url" name="url" placeholder="https://example.com">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="image_url" class="form-label">ì´ë¯¸ì§€ URL (ì„ íƒì‚¬í•­)</label>
                                        <input type="url" class="form-control" id="image_url" name="file_url" placeholder="https://example.com/image.jpg">
                                    </div>
                                    
                                    <div class="preview-box">
                                        <h5>ë¯¸ë¦¬ë³´ê¸°</h5>
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="preview-device android" id="preview-device">ì•ˆë“œë¡œì´ë“œ</span>
                                            <span class="preview-title" id="preview-title">ì•Œë¦¼ ì œëª©</span>
                                        </div>
                                        <div class="preview-body" id="preview-body">ì•Œë¦¼ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                                    </div>
                                    
                                    <div class="d-grid gap-2 mt-4">
                                        <button type="button" id="sendIndividualPushBtn" class="btn btn-primary">
                                            <i class="fas fa-paper-plane me-2"></i>í‘¸ì‹œ ì•Œë¦¼ ë³´ë‚´ê¸°
                                        </button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- ì „ì²´ í‘¸ì‹œ íƒ­ -->
                            <div class="tab-pane fade" id="group" role="tabpanel" aria-labelledby="group-tab">
                                <form id="groupPushForm" action="push_api.php" method="post">
                                    <input type="hidden" name="push_type" value="group">
                                    
                                    <div class="mb-3">
                                        <label class="form-label">ëŒ€ìƒ ê¸°ê¸°</label>
                                        <div class="d-flex">
                                            <div class="form-check me-4">
                                                <input class="form-check-input" type="checkbox" name="target_devices[]" id="target_android" value="android" checked>
                                                <label class="form-check-label" for="target_android">
                                                    <i class="fab fa-android device-icon text-success"></i>ì•ˆë“œë¡œì´ë“œ
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="target_devices[]" id="target_ios" value="ios" checked>
                                                <label class="form-check-label" for="target_ios">
                                                    <i class="fab fa-apple device-icon text-dark"></i>iOS
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="group_title" class="form-label">ì œëª©</label>
                                        <input type="text" class="form-control" id="group_title" name="title" required placeholder="ì•Œë¦¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="group_message" class="form-label">ë‚´ìš©</label>
                                        <textarea class="form-control" id="group_message" name="message" rows="3" required placeholder="ì•Œë¦¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="group_url" class="form-label">URL (ì„ íƒì‚¬í•­)</label>
                                        <input type="url" class="form-control" id="group_url" name="url" placeholder="https://example.com">
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="group_file_url" class="form-label">ì´ë¯¸ì§€ URL (ì„ íƒì‚¬í•­)</label>
                                        <input type="url" class="form-control" id="group_file_url" name="file_url" placeholder="https://example.com/image.jpg">
                                    </div>
                                    
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>ì£¼ì˜:</strong> ì „ì²´ í‘¸ì‹œëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë³´ëƒ…ë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.
                                    </div>
                                    
                                    <div class="d-grid gap-2 mt-4">
                                        <button type="button" id="sendGroupPushBtn" class="btn btn-primary">
                                            <i class="fas fa-paper-plane me-2"></i>ì „ì²´ í‘¸ì‹œ ì•Œë¦¼ ë³´ë‚´ê¸°
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì„¤ì • ë°ì´í„° (PHPì—ì„œ ë¡œë“œ)
        const testNotificationConfig = <?php echo json_encode($test_notification_config); ?>;

        // í…ŒìŠ¤íŠ¸ ì„¤ì • ì‚¬ìš© ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('useTestSettings').addEventListener('change', function() {
            if (this.checked) {
                // í…ŒìŠ¤íŠ¸ ì„¤ì • ë°ì´í„°ë¡œ í¼ ì±„ìš°ê¸°
                document.getElementById('title').value = testNotificationConfig.title;
                document.getElementById('message').value = testNotificationConfig.message;
                document.getElementById('url').value = testNotificationConfig.domain;

                if (testNotificationConfig.image) {
                    // ì´ë¯¸ì§€ URL êµ¬ì„± (í˜„ì¬ í´ë”ì˜ ì´ë¯¸ì§€ íŒŒì¼)
                    const imageUrl = window.location.origin + window.location.pathname.replace('index.php', '') + testNotificationConfig.image;
                    document.getElementById('image_url').value = imageUrl;
                }

                // ì „ì²´ í‘¸ì‹œ í¼ë„ ì—…ë°ì´íŠ¸
                document.getElementById('group_title').value = testNotificationConfig.title;
                document.getElementById('group_message').value = testNotificationConfig.message;
                document.getElementById('group_url').value = testNotificationConfig.domain;

                if (testNotificationConfig.image) {
                    const imageUrl = window.location.origin + window.location.pathname.replace('index.php', '') + testNotificationConfig.image;
                    document.getElementById('group_file_url').value = imageUrl;
                }

                // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                updatePreview();

                console.log('í…ŒìŠ¤íŠ¸ ì„¤ì • ë¡œë“œë¨:', testNotificationConfig);
            } else {
                // ì²´í¬ í•´ì œ ì‹œ í¼ ì´ˆê¸°í™”
                document.getElementById('title').value = '';
                document.getElementById('message').value = '';
                document.getElementById('url').value = '';
                document.getElementById('image_url').value = '';

                document.getElementById('group_title').value = '';
                document.getElementById('group_message').value = '';
                document.getElementById('group_url').value = '';
                document.getElementById('group_file_url').value = '';

                updatePreview();
            }
        });

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updatePreview() {
            const title = document.getElementById('title').value || 'ì•Œë¦¼ ì œëª©';
            const message = document.getElementById('message').value || 'ì•Œë¦¼ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.';
            const deviceType = document.querySelector('input[name="app"]:checked').value;
            
            document.getElementById('preview-title').textContent = title;
            document.getElementById('preview-body').textContent = message;
            
            const previewDevice = document.getElementById('preview-device');
            if (deviceType === 'android') {
                previewDevice.textContent = 'ì•ˆë“œë¡œì´ë“œ';
                previewDevice.className = 'preview-device android';
            } else {
                previewDevice.textContent = 'iOS';
                previewDevice.className = 'preview-device ios';
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.getElementById('title').addEventListener('input', updatePreview);
        document.getElementById('message').addEventListener('input', updatePreview);
        document.querySelectorAll('input[name="app"]').forEach(radio => {
            radio.addEventListener('change', updatePreview);
        });
        
        // ê°œë³„ í‘¸ì‹œ ì „ì†¡ ì´ë²¤íŠ¸
        document.getElementById('sendIndividualPushBtn').addEventListener('click', function() {
            const formData = new FormData(document.getElementById('individualPushForm'));

            console.log('ì „ì†¡ ë°ì´í„°:', Object.fromEntries(formData));

            fetch('push_api.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log('ì‘ë‹µ ë°ì´í„°:', data);
                if (data.success) {
                    alert('í‘¸ì‹œ ì•Œë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    console.error('ì „ì†¡ ì‹¤íŒ¨:', data);
                    console.error('ì‹¤íŒ¨ ìƒì„¸ ì •ë³´:', JSON.stringify(data.data, null, 2));

                    let errorMsg = 'í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.message;
                    if (data.data) {
                        errorMsg += '\n\nìƒì„¸ ì •ë³´:';
                        errorMsg += '\n- Firebase ì„¤ì •: ' + (data.data.firebase_config || 'N/A');
                        errorMsg += '\n- í”„ë¡œì íŠ¸ ID: ' + (data.data.project_id || 'N/A');
                        errorMsg += '\n- arg3: ' + (data.data.arg3 || 'N/A');
                        errorMsg += '\n- ê¸°ë³¸ URL: ' + (data.data.default_url || 'N/A');
                        errorMsg += '\n- ì—ëŸ¬: ' + (data.data.error || 'N/A');
                    }
                    errorMsg += '\n\nì½˜ì†”ì—ì„œ ì „ì²´ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.';

                    alert(errorMsg);
                }
            })
            .catch(error => {
                console.error('ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            });
        });
        
        // ì „ì²´ í‘¸ì‹œ ì „ì†¡ ì´ë²¤íŠ¸
        document.getElementById('sendGroupPushBtn').addEventListener('click', function() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í‘¸ì‹œ ì•Œë¦¼ì„ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const formData = new FormData(document.getElementById('groupPushForm'));

                console.log('ì „ì²´ í‘¸ì‹œ ì „ì†¡ ë°ì´í„°:', Object.fromEntries(formData));

                fetch('push_api.php', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    console.log('ì „ì²´ í‘¸ì‹œ ì‘ë‹µ:', data);
                    if (data.success) {
                        alert('ì „ì²´ í‘¸ì‹œ ì•Œë¦¼ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    } else {
                        console.error('ì „ì²´ í‘¸ì‹œ ì „ì†¡ ì‹¤íŒ¨:', data);
                        alert('ì „ì²´ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.message + '\n\nìì„¸í•œ ë‚´ìš©ì€ ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
                    }
                })
                .catch(error => {
                    console.error('ì „ì²´ í‘¸ì‹œ ì˜¤ë¥˜:', error);
                    alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            }
        });
    </script>
</body>
</html> 